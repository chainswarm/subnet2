# =============================================================================
# Subnet2 Evaluation Infrastructure Configuration
# =============================================================================
# Copy this file to .env and configure for your deployment

# =============================================================================
# POSTGRESQL DATABASE
# =============================================================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=subnet2
POSTGRES_USER=subnet2
POSTGRES_PASSWORD=your_secure_password_here

# =============================================================================
# REDIS (Celery Broker)
# =============================================================================
REDIS_URL=redis://localhost:6379/0

# =============================================================================
# CELERY CONFIGURATION
# =============================================================================
WORKER_CONCURRENCY=2
LOG_LEVEL=INFO

# =============================================================================
# FLOWER (Celery Task Monitor)
# =============================================================================
# Access Flower UI at http://localhost:5555
FLOWER_USER=admin
FLOWER_PASSWORD=your_flower_password_here

# =============================================================================
# EVALUATION SETTINGS
# =============================================================================
REPOS_PATH=/data/repos
DATA_PATH=/data/datasets

BENCHMARK_MAX_EXECUTION_TIME=3600
BENCHMARK_MEMORY_LIMIT=16g
BENCHMARK_CPU_LIMIT=4

# =============================================================================
# BITTENSOR CONFIGURATION
# =============================================================================
WALLET_NAME=validator
WALLET_HOTKEY=default
NETUID=2

# Bittensor volume path - mount entire .bittensor directory (not just wallets)
# This allows the validator to store state in /root/.bittensor/miners/...
# For WSL, use the full path: /home/<username>/.bittensor
# For native Linux/Mac: ~/.bittensor or /home/<username>/.bittensor
BITTENSOR_VOLUME_PATH=~/.bittensor

# =============================================================================
# SUBTENSOR NETWORK CONNECTION
# =============================================================================
# Configure which Bittensor network/node the validator connects to.
# You can use either:
#   1. Remote public endpoints (finney, test)
#   2. Local subtensor nodes (run via docker-compose.XXX.yml files)
#
# OPTION 1: Remote Public Endpoints (No local node needed)
# ---------------------------------------------------------
# SUBTENSOR_NETWORK=finney          # Bittensor mainnet (production)
# SUBTENSOR_NETWORK=test            # Bittensor testnet
#
# OPTION 2: Local Subtensor Nodes (Better reliability, run separately)
# ---------------------------------------------------------------------
# Step 1: Start the subtensor node:
#   docker compose -f ops/docker-compose.localnet.yml up -d   # Local dev node
#   docker compose -f ops/docker-compose.testnet.yml up -d    # Testnet node
#   docker compose -f ops/docker-compose.mainnet.yml up -d    # Mainnet node
#
# Step 2: Configure connection (must be on 'subnet' Docker network):
# SUBTENSOR_NETWORK=ws://local-subtensor:9944    # For localnet
# SUBTENSOR_NETWORK=ws://testnet-lite:9944       # For testnet
# SUBTENSOR_NETWORK=ws://mainnet-lite:9944       # For mainnet
#
# Step 3: Start application services:
#   docker compose -f ops/docker-compose.yml up -d
#
# DEFAULT: Use remote finney endpoint
SUBTENSOR_NETWORK=finney

SUBMISSION_TIMEOUT_SECONDS=30

# =============================================================================
# TOURNAMENT CONFIGURATION
# =============================================================================
# Timing controls for tournament phases

# DEVELOPMENT SETTINGS (Fast iteration for testing)
# Submission phase: 2 minutes (120 seconds)
# Epoch count: 3 epochs
# Epoch duration: 3 minutes (180 seconds)
# Total tournament time: 2min submission + (3 epochs × 3min) = 11 minutes
TOURNAMENT_SUBMISSION_DURATION_SECONDS=120
TOURNAMENT_EPOCH_COUNT=3
TOURNAMENT_EPOCH_DURATION_SECONDS=180

# PRODUCTION SETTINGS (Uncomment and adjust for production use)
# Submission phase: 24 hours (86400 seconds)
# Epoch count: 5 epochs
# Epoch duration: 72 hours (259200 seconds) - 3 days per epoch
# Total tournament time: 24h submission + (5 epochs × 72h) = 15 days + 24h
# TOURNAMENT_SUBMISSION_DURATION_SECONDS=86400
# TOURNAMENT_EPOCH_COUNT=5
# TOURNAMENT_EPOCH_DURATION_SECONDS=259200

# Supported networks for evaluation (comma-separated)
TOURNAMENT_NETWORKS=torus

# Schedule mode: 'manual' for operator control, 'automatic' for scheduled tournaments
TOURNAMENT_SCHEDULE_MODE=manual

# =============================================================================
# DOCKER CONFIGURATION
# =============================================================================
DOCKER_HOST=unix:///var/run/docker.sock

# =============================================================================
# DEPLOYMENT NOTES
# =============================================================================
# 1. Start infrastructure:
#    cd subnet2/ops && docker compose up -d
#
# 2. Run migrations:
#    docker compose run migrations
#
# 3. Build evaluation image:
#    docker compose build evaluation-worker
#
# 4. View logs:
#    docker compose logs -f evaluation-worker
#
# 5. Run validator separately (outside Docker):
#    python neurons/validator.py --netuid 1 --wallet.name validator
